<!DOCTYPE html>
<html>

<head>

    <meta http-equiv="Expires" content="86400">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta charset="utf-8">
    <meta name="typewriter" content="An interactive exhibit for the Jack London Museum">
    
    <!--    <meta http-equiv="X-UA-Compatible" content="IE=edge">-->
    <title>Tell Your Story</title>
    <link rel="stylesheet" href="main.css">
    <script type='text/javascript' src='js/StarWebPrintBuilder.js'></script>
    <script type='text/javascript' src='js/StarWebPrintTrader.js'></script>
    <script type="text/javascript">
        function print() {
            //            childWindow = window.open('', 'childWindow', 'location=yes, menubar=no, toolbar=no');
            //            childWindow.document.open();
            //            childWindow.document.write('<html><head></head><body style="font-family:Courier;font-size: 18px;">');
            //            childWindow.document.write(document.getElementById('targetTextArea').value.replace(/\n/gi, '<br>'));
            //            childWindow.document.write('</body></html>');
            //            childWindow.print();
            //            childWindow.document.close();
            //            childWindow.close();


            var textArea = String(document.getElementById('targetTextArea').value.replace(/\n/gi, '<br>'));

            var cleanTextArea = textArea.replace(/<br>/g, "n\\");
            
            console.log(cleanTextArea);


            var builder = new StarWebPrintBuilder();

            var request = '';

            request += builder.createInitializationElement();

            request += builder.createTextElement({
                characterspace: 0
            });

            request += builder.createAlignmentElement({
                position: 'left'
            });
            request += builder.createTextElement({
                data: textArea
            });
            request += builder.createCutPaperElement({
                feed: true
            });

            var url = "https://localhost:8001/StarWebPRNT/SendMessage";
            var papertype = "normal";
            var trader = new StarWebPrintTrader({
                url: url,
                papertype: papertype
            });

            trader.onReceive = function(response) {
//                alert(response.responseText);
            }
            trader.onError = function(response) {
                alert(response.responseText);
            }
            console.log(request);
            trader.sendMessage({
                request: request
            });

            //            setTimeout(check, 1000);
            location.reload();

        }
    </script>

</head>

<body>

    <h1 align="center">What's Your Story?</h1>

    <div class="myelement1">

        <textarea maxlength="1200" type="text" name="textarea" wrap="wrap" id="targetTextArea" rows="10" cols="30" placeholder="Tell Your Story..."></textarea>
        <input type="submit" onclick="print()" value="Print Text" />

    </div>

</body>